/*nolure@vip.qq.com|http://nolure.github.io/nojs.docs*/define("nojs/module/lightbox",[],function(require,a,b){function c(){var a=[],b=null,c=function(){for(var b=0;b<a.length;b++)a[b].end?a.splice(b--,1):a[b]();!a.length&&d()},d=function(){clearInterval(b),b=null};return function(d,e,f,g){var h,i,j,k,l,m=new Image;return m.src=d,m.complete?(e.call(m),f&&f.call(m),void 0):(i=m.width,j=m.height,m.onerror=function(){g&&g.call(m),h.end=!0,m=m.onload=m.onerror=null},h=function(){k=m.width,l=m.height,(k!==i||l!==j||k*l>1024)&&(e.call(m),h.end=!0)},h(),m.onload=function(){!h.end&&h(),f&&f.call(m),m=m.onload=m.onerror=null},h.end||(a.push(h),null===b&&(b=setInterval(c,40))),void 0)}}function d(b,c){this.box="string"==typeof b?a("#"+b):b,this.box.length&&(this.options=c=c||{},this.tag=c.tag||"img",this.item=this.box.find(this.tag),this.length=this.item.length,this.showInfo=0==c.showInfo?!1:!0,this.fullScreen=c.fullScreen,this.init())}return d.prototype={init:function(){this.layer=b.layer,this.wrap=a('<div class="lightbox_wrap" unselectable="on"><div class="content"><div class="img"></div><i class="loading"></i><i class="p prev"></i><i class="p next"></i><i class="close"></i></div><div class="info"></div></div>').appendTo(a("body")),this.content=this.wrap.children(".content"),this.info=this.wrap.children(".info"),this.img=this.wrap.find(".img"),this.close=this.wrap.find(".close"),this.loading=this.wrap.find(".loading"),this.ready=c(),this.image=a('<img src="" />'),this.bind()},bind:function(){var b,c,d=this;if(this.showInfo){var c,e,f,g=this.info.append(['<div class="pic_list">','<i class="p prev" data-action="scroll"></i>','<i class="p next" data-action="scroll"></i>','<div class="wrap"><div class="list"></div></div>',"</div>",'<div class="txt">','<div class="num"><em></em> / <i></i></div>','<div class="title"></div>','<div class="desc"></div>',"</div>",'<div class="option"><a href="" data-action="full_screen">全屏</a><a href="" data-action="close">关闭</a></div>'].join("")).find(".pic_list .list");this.info.click(function(b){var c,g,h=b.target,i=h.tagName.toLowerCase();if("img"==i)d.load(a(h).index());else if("a"==i)return g=a(h),c=g.attr("data-action"),"full_screen"==c?(e=a(window).height(),f||(f=d.content.height()/e),d.fullScreen=d.fullScreen?null:!0,d.content.animate({height:d.fullScreen?e:e*f},200,function(){d.fullScreen?d.content.height("100%"):d.content.removeAttr("style"),d.load(d.index,!0)}),d.close.hide(),g.text(d.fullScreen?"退出全屏":"全屏")):"close"==c&&d.hide(),!1}),a.each(this.item,function(b,d){c="img"==d.tagName.toLowerCase()?a(d):a(d).find("img"),c.length&&(c=c.clone().attr({style:""}),g.append(c))}),g.width(c.outerWidth()*this.length),this.number=this.info.find(".num"),this.number.find("i").text(this.length)}else this.info.hide(),this.content.height("100%");this.page=this.wrap.find("i.p").css({opacity:"0.4"}),this.createPageIco(this.page),this.item.each(function(b){var c=a(this);!function(a){c.click(function(){return d.show(a),!1})}(b)}),this.close.click(function(){d.hide()}),this.page.click(function(b){a.stopDefault(b),d.load(a(this).hasClass("prev")?--d.index:++d.index)}).hover(function(){a(this).is(":visible")&&a(this).stop().fadeTo(200,1)},function(){a(this).is(":visible")&&a(this).stop().fadeTo(200,.2)}),a(window).resize(function(){clearTimeout(b),d.close.hide(),b=setTimeout(function(){d.load(d.index,!0)},300)})},show:function(c){a("html").addClass("lightbox"),b.setPos(this.wrap),this.wrap.fadeIn(300),this.layer.show(.85),"function"==typeof this.options.onShow&&this.options.onShow.call(this),this.load(c),this.fullScreen&&(this.fullScreen=null,this.info.find("a[data-action=full_screen]").click())},createPageIco:function(c){function d(b){var c,d=this.width,e=this.height,f=this.ctx;this.hasCanvas?(f.lineWidth=7,f.strokeStyle="#000"):(this.canvas=a("<i></i>"),this.ico.append(this.canvas),this.color="#BABABA"),c="prev"==b?[.8*d,0,.1*d,.5*e,.8*d,e]:[.2*d,0,.9*d,.5*e,.2*d,e],this.drawLine(c,!1,3),this.hasCanvas?(f.lineWidth=5,f.strokeStyle="rgba(255,255,255,0.7)"):this.color="#000000",this.drawLine(c,!1,4)}b.ico.add("prev",function(){d.call(this,"prev")}),b.ico.add("next",function(){d.call(this,"next")});var e={type:"prev",width:50,height:110,color:"#000000",bgcolor:"#cccccc"};new b.ico(c.eq(0),e),e.type="next",new b.ico(c.eq(1),e),this.showInfo&&(e.width=18,e.height=36,new b.ico(c.eq(3),e),e.type="prev",new b.ico(c.eq(2),e)),new b.ico(this.loading,{type:"loading",color:"#006CFF",width:48,height:48}),new b.ico(this.close,{type:"close",bgcolor:"#999",color:"#000",width:32,height:32})},srcRule:function(a,b){return this.options.srcRule?this.options.srcRule(a,b):a},load:function(b,c){if(b=b>this.length-1?0:b,b=0>b?this.length-1:b,c)return this.setCenter(this.image[0]),void 0;var d,e,f=this,g=a(this.item[b]);g.length&&("img"==g[0].tagName.toLowerCase()||(g=g.find("img"),g.length))&&(this.img.find("img").length||(this.img.show(),this.img.append(this.image)),d=g.attr("src"),this.showInfo&&(e=this.info.find(".wrap img"),this.info.find(".wrap").stop().animate({scrollLeft:e.outerWidth()*(b-2)},200),this.number.find("em").text(b+1),this.info.find(".title").html(g.attr("data-title")),this.info.find(".desc").html(g.attr("data-desc"))),d=this.srcRule(d,g),this.image.attr("src",d).hide(),this.loading.show(),this.ready(d,function(){f.image.data("size",{width:this.width,height:this.height}),f.setCenter(this)},function(){f.loading.hide(),setTimeout(function(){f.image.show()},100)},function(){f.close.show(),f.loading.hide()}),this.index=b,this.page.show(),0==b&&this.page.eq(0).hide(),b==this.item.length-1&&this.page.eq(1).hide(),this.showInfo&&this.info.find(".pic_list img").eq(b).addClass("current").siblings().removeClass("current"))},setCenter:function(a){var b=this,c=this.image.data("size"),d=c?c.width:a.width,e=c?c.height:a.height,f=2*(parseInt(this.img.css("padding-left"),10)||0),g=this.limit({width:d+f,height:e+f}),h=200;d=g.width,e=g.height,this.img.animate({"margin-left":-d/2,"margin-top":-e/2,width:d-f,height:e-f},h,function(){b.close.show()}),d-=f,e-=f,this.image.animate({"margin-left":-d/2,"margin-top":-e/2,width:d,height:e},h),this.close.css({left:this.content.width()/2+d/2+f/2,top:this.content.height()/2-e/2-f/2,display:"none",margin:"-16px 0 0 -16px"})},limit:function(a){var b=a.width,c=a.height,d=this.content.width(),e=this.content.height(),f=b/c,g=d/e;return f>g&&b>d?(b=d,c=b/f):g>=f&&c>e&&(c=e,b=c*f),{width:b,height:c}},hide:function(){a("html").removeClass("lightbox"),this.wrap.hide(),this.layer.hide(),"function"==typeof this.options.onHide&&this.options.onHide.call(this)}},d});