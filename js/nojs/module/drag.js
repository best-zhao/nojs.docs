/*2013/11/19-http://nolure.github.io/nojs.docs*/define("nojs/module/drag",[],function(require,a){a.addCss(".addIndex{z-index:99999}");var b=function(a,b,c){this.drag=a,this.opt=c=c||{},this.move=b?b:a,this.delegat=c.delegat===!0?!0:!1,this.setDrag=c.setDrag,this.moveing=!1,this.onDragDown=null,this.onDragStart=null,this.MoveEvent=null,this.UpEvent=null,this.dragLastPos=[],this.dragNowPos=[],this.mouseLastPos={},this.disable=!1,this.limit=c.limit,this.wrap=c.wrap,this.overflow=c.overflow,this.A=null,this.delay=this.opt.delay||9,this.delegat||(b?this.move.css("cursor","move"):this.drag.css("cursor","move"));var d=this;this.move.bind("mousedown.drag",function(a){d.DragDown(a)})};return b.prototype={DragDown:function(b){if(this.disable)return!1;b=b||window.event;var c,d,e,f,g,h,i,j,k=this,l=a(b.target);if(this.delegat&&(this.drag=l.attr("isdrag")||l.attr("isdragmove")?l.attr("isdragmove")?l.closest("[isdrag]"):l:null),this.drag&&this.drag.length){if(this.onDragDown&&0==this.onDragDown.call(this))return!1;for(this.moveing=!0,this.dragNowPos=[],this.dragLastPos=[],this.maxSize={L:[],T:[],B:[],R:[],W:null,H:null},this.group=this.group||this.drag,this.drag.addClass("addIndex"),e=0,f=this.drag.length;f>e;e++)d=this.drag.eq(e),c="static"===d.css("position"),g=c?d.offset().left:parseInt(d.css("left"),10)||0,h=c?d.offset().top:parseInt(d.css("top"),10)||0,this.wrap&&this.wrap.length&&(g-=this.wrap.offset().left-this.wrap.scrollLeft(),h-=this.wrap.offset().top-this.wrap.scrollTop()),i=d.outerWidth(),j=d.outerHeight(),this.dragLastPos.push({x:g,y:h}),c&&d.css({position:"absolute"}),d.css({left:g,top:h}),(!this.group||d.is(this.group))&&(this.maxSize.L.push(g),this.maxSize.T.push(h),this.maxSize.R.push(g+i),this.maxSize.B.push(h+j));return b.preventDefault(),this.maxSize.L=Math.min.apply(null,this.maxSize.L),this.maxSize.T=Math.min.apply(null,this.maxSize.T),this.maxSize.W=Math.max.apply(null,this.maxSize.R)-this.maxSize.L,this.maxSize.H=Math.max.apply(null,this.maxSize.B)-this.maxSize.T,this.limit&&(this.maxSize.l=this.limit.offset().left+parseInt(this.limit.css("border-left-width")),this.maxSize.t=this.limit.offset().top+parseInt(this.limit.css("border-top-width")),"static"!==this.limit.css("position")&&this.limit.find(d).length&&(this.maxSize.l=this.maxSize.t=0),this.maxSize.w=this.limit.innerWidth()-this.maxSize.W+this.maxSize.l,this.maxSize.h=this.limit.innerHeight()-this.maxSize.H+this.maxSize.t,this.overflow&&(this.maxSize.l-=this.overflow,this.maxSize.t-=this.overflow,this.maxSize.w+=this.overflow,this.maxSize.h+=this.overflow)),this.mouseLastPos={x:b.clientX,y:b.clientY},this.onDragStart&&0==this.onDragStart.call(this)?!1:(a(document).bind("mousemove.drag",function(a){k.DragMove(a)}).bind("mouseup.drag",function(a){k.DragUp(a)}),void 0)}},DragMove:function(a){if(this.moveing&&!this.disable&&this.drag){a=a||window.event,a.preventDefault();var b,c,d,e,f,g={x:a.clientX-this.mouseLastPos.x,y:a.clientY-this.mouseLastPos.y},h=g.x,i=g.y,j=this.drag.length,k=this;for(this.limit&&(e=this.maxSize.L+h,f=this.maxSize.T+i,g.x=e<this.maxSize.l?this.maxSize.l-this.maxSize.L:h,g.x=e>this.maxSize.w?this.maxSize.w-this.maxSize.L:g.x,g.y=f<this.maxSize.t?this.maxSize.t-this.maxSize.T:i,g.y=f>this.maxSize.h?this.maxSize.h-this.maxSize.T:g.y),this.setOffset&&(g=this.setOffset.call(this,g)),h=g.x,i=g.y,b=0;j>b;b++)c=this.drag.eq(b),d=this.dragLastPos[b],this.dragNowPos[b]={x:d.x+h,y:d.y+i},c.css({left:this.dragNowPos[b].x,top:this.dragNowPos[b].y});this.MoveEvent&&(clearTimeout(k.A),k.A=setTimeout(function(){k.MoveEvent.call(k,{x:h,y:i,w:k.maxSize.W,h:k.maxSize.H})},k.delay))}},DragUp:function(b){if(!this.disable){var c=this;this.moveing=!1,a(document).off("mousemove.drag mouseup.drag"),this.drag.removeClass("addIndex"),c.A=clearTimeout(c.A),this.UpEvent&&this.UpEvent.call(this),this.maxSize=this.dragLastPos=this.dragNowPos=null,b.preventDefault()}}},b});