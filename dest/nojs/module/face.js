/*nolure@vip.qq.com http://nolure.github.io/nojs.docs*/define("nojs/module/face",[],function(require,$,ui){function insertOnCursor(a){a&&(this.textBox=a,this.setCaret())}var face=function(a){a=a||{},this.button=a.button,this.insert=a.insert,this.button&&this.insert&&(this.baseUrl=a.baseUrl?a.baseUrl:"/img/face/",this.themeName=a.theme,this.theme=face.theme[a.theme],this.theme||(this.theme=face.theme["default"],this.themeName="default"),this.faceBox=null,this.itemBox=null,this.item=null,this.init())};return face.theme={"default":{item:{1:"晕",2:"可爱",3:"大笑",4:"呲牙",5:"大哭",6:"拳击",7:"投降",8:"俯卧撑",9:"疑问(不解)",10:"发财",11:"瞌睡",12:"打酱油",13:"憨笑",14:"吃西瓜",15:"汗",16:"惊恐",17:"中标",18:"翻墙",19:"摇头",20:"念经",21:"害羞",22:"睡觉",23:"勤奋",24:"真棒",25:"偷笑",26:"听音乐",27:"晕"},fix:".gif"},img:{item:{e100:"晕",e101:"可爱",e102:"大笑",e103:"呲牙",e104:"大哭",e105:"拳击",e106:"投降",e107:"俯卧撑",e108:"疑问(不解)",e109:"发财",e110:"瞌睡",e111:"打酱油",e112:"憨笑",e113:"吃西瓜",e114:"汗",e115:"惊恐",e116:"中标",e117:"翻墙",e118:"摇头",e119:"念经",e120:"害羞",e121:"睡觉",e122:"勤奋",e123:"真棒",e124:"偷笑",e125:"听音乐",e126:"晕",e127:"真棒",e128:"偷笑",e129:"听音乐",e130:"晕",e131:"偷笑",e132:"听音乐",e133:"晕",e134:"听音乐",e135:"晕",e136:"偷笑",e137:"听音乐",e138:"听音乐",e139:"晕",e140:"偷笑",e141:"听音乐",e142:"听音乐",e143:"听音乐",e144:"晕",e145:"偷笑",e146:"听音乐",e147:"听音乐"},fix:".gif"},comcom:{item:{smile:"微笑",sad:"难过",biggrin:"大笑",cry:"大哭",huffy:"怒火",shocked:"惊讶",tongue:"调皮",shy:"害羞",titter:"偷笑",sweat:"冷汗",mad:"折磨",lol:"呲牙",hug:"抱抱",victory:"胜利",time:"时钟",kiss:"香吻",handshake:"握手",call:"电话",loveliness:"可爱",funk:"惊恐",curse:"咒骂",dizzy:"奋斗",shutup:"闭嘴",sleepy:"瞌睡"},fix:".gif"}},face.prototype={init:function(){var a=this,b=['<div id="nj_face" class="nj_face">','<div class="con">','<div class="tit"><b>默认表情</b></div>','<ul class="list clearfix"></ul>',"</div>",'<span class="a"><em>◆</em><i>◆</i></span>',"</div>"].join("");this.faceBox=new ui.menu(this.button,{mode:"click",className:"face_menu",onShow:function(){this.menu.data("init")||(this.menu.data("init",!0),this.setCon(b),a.itemBox=this.menu.find("ul.list"),a.loadFace())}})},loadFace:function(){var a=this,b="",c=this.baseUrl+this.themeName+"/";for(var d in this.theme.item)b+='<li><img src="'+c+d+this.theme.fix+'" title="'+this.theme.item[d]+'" alt="" /></li>';this.itemBox.html(b),this.item=this.itemBox.find("img"),this.faceBox.menu.click(function(b){var c,d=b.target;"img"==d.tagName.toLowerCase()&&(c="[:"+$(d).attr("title")+"]",a.insertTo(c),a.faceBox.hide())})},insertTo:function(a){var b=new insertOnCursor(this.insert);b.insertAtCaret(a),this.insert.focus()},replaceFace:function(con){if(!con)var con=this.insert.val();var faceArray=this.theme.item,N,pic;for(var i in faceArray)N=faceArray[i],-1!=con.indexOf("[:"+N+"]")&&(pic='<img src="'+this.baseUrl+this.themeName+"/"+i+this.theme.fix+'" alt="'+N+'" title="'+N+'" />',con=con.replace(eval("/\\[:"+N.replace("(","\\(").replace(")","\\)")+"\\]/g"),pic));return con}},insertOnCursor.prototype={setCaret:function(){if($.browser.msie){var a=this;a.textBox.on("click select keyup",function(){a.textBox[0].caretPos=document.selection.createRange().duplicate()})}},insertAtCaret:function(a){var b=this.textBox[0];if(document.all&&b.createTextRange&&b.caretPos){var c=b.caretPos;c.text=""==c.text.charAt(c.text.length-1)?a+"":a}else if(b.setSelectionRange){var d=b.selectionStart,e=b.selectionEnd,f=b.value.substring(0,d),g=b.value.substring(e);b.value=f+a+g;var h=a.length;b.setSelectionRange(d+h,d+h)}else b.value+=a},unselectContents:function(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()},selectContents:function(){this.textBox.each(function(a){var b,c,d,e,f=this;(d=f.ownerDocument)&&(e=d.defaultView)&&"undefined"!=typeof e.getSelection&&"undefined"!=typeof d.createRange&&(b=window.getSelection())&&"undefined"!=typeof b.removeAllRanges?(c=d.createRange(),c.selectNode(f),0==a&&b.removeAllRanges(),b.addRange(c)):document.body&&"undefined"!=typeof document.body.createTextRange&&(c=document.body.createTextRange())&&(c.moveToElementText(f),c.select())})}},face});