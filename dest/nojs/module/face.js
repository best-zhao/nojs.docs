/*nolure@vip.qq.com|http://nolure.github.io/nojs.docs*/define("nojs/module/face",[],function(require,$,ui){function insertOnCursor(a){a&&(this.textBox=a,this.setCaret())}var face=function(a){a=a||{},this.button=a.button,this.insert=a.insert,this.button&&this.insert&&(this.baseUrl=a.baseUrl?a.baseUrl:"/img/face/",this.themeName=a.theme,this.theme=face.theme[a.theme],this.theme||(this.theme=face.theme["default"],this.themeName="default"),this.faceBox=null,this.itemBox=null,this.item=null,this.init())};return face.theme={"default":{item:{1:"晕",2:"可爱",3:"大笑",4:"呲牙",5:"大哭",6:"拳击",7:"投降",8:"俯卧撑",9:"疑问(不解)",10:"发财",11:"瞌睡",12:"打酱油",13:"憨笑",14:"吃西瓜",15:"汗",16:"惊恐",17:"中标",18:"翻墙",19:"摇头",20:"念经",21:"害羞",22:"睡觉",23:"勤奋",24:"真棒",25:"偷笑",26:"听音乐",27:"晕"},fix:".gif"},qq:{item:{e100:"微笑",e101:"撇嘴",e102:"色",e103:"发呆",e104:"得意",e105:"流泪",e106:"害羞",e107:"闭嘴",e108:"睡",e109:"大哭",e110:"尴尬",e111:"发怒",e112:"调皮",e113:"龇牙",e114:"惊讶",e115:"难过",e116:"酷",e117:"冷汗",e118:"抓狂",e119:"吐",e120:"偷笑",e121:"可爱",e122:"白眼",e123:"傲慢",e124:"饥饿",e125:"困",e126:"惊恐",e127:"流汗",e128:"憨笑",e129:"大兵",e130:"奋斗",e131:"咒骂",e132:"疑问",e133:"嘘",e134:"晕",e135:"折磨",e136:"衰",e137:"骷髅",e138:"敲打",e139:"再见",e140:"擦汗",e141:"抠鼻",e142:"鼓掌",e143:"糗大了",e144:"坏笑",e145:"左哼哼",e146:"右哼哼",e147:"哈欠",e148:"鄙视",e149:"委屈",e150:"快哭了",e151:"阴险",e152:"亲亲",e153:"吓",e154:"可怜",e155:"菜刀",e156:"西瓜",e157:"啤酒",e158:"篮球",e159:"乒乓",e160:"咖啡",e161:"饭",e162:"猪头",e163:"玫瑰",e164:"凋谢",e165:"示爱",e166:"爱心",e167:"心碎",e168:"蛋糕",e169:"闪电",e170:"炸弹",e171:"刀",e172:"足球",e173:"瓢虫",e174:"便便",e175:"月亮",e176:"太阳",e177:"礼物",e178:"拥抱",e179:"强",e180:"弱",e181:"握手",e182:"胜利",e183:"抱拳",e184:"勾引",e185:"拳头",e186:"差劲",e187:"爱你",e188:"NO",e189:"OK",e190:"爱情",e191:"飞吻",e192:"跳跳",e193:"发抖",e194:"怄火",e195:"转圈",e196:"磕头",e197:"回头",e198:"跳绳",e199:"挥手",e200:"激动"},fix:".gif"}},face.prototype={init:function(){var a=this,b=['<div id="nj_face" class="nj_face">','<div class="con">','<div class="tit"><b>默认表情</b></div>','<ul class="list clearfix"></ul>',"</div>",'<span class="a"><em>◆</em><i>◆</i></span>',"</div>"].join("");this.faceBox=new ui.menu(this.button,{mode:"click",className:"face_menu",onShow:function(){this.menu.data("init")||(this.menu.data("init",!0),this.setCon(b),a.itemBox=this.menu.find("ul.list"),a.loadFace())}})},loadFace:function(){var a=this,b="",c=this.baseUrl+this.themeName+"/";for(var d in this.theme.item)b+='<li><img src="'+c+d+this.theme.fix+'" title="'+this.theme.item[d]+'" alt="" /></li>';this.itemBox.html(b),this.item=this.itemBox.find("img"),this.faceBox.menu.click(function(b){var c,d=b.target;"img"==d.tagName.toLowerCase()&&(c="[:"+$(d).attr("title")+"]",a.insertTo(c),a.faceBox.hide())})},insertTo:function(a){var b=new insertOnCursor(this.insert);b.insertAtCaret(a),this.insert.focus()},replaceFace:function(con){if(!con)var con=this.insert.val();var faceArray=this.theme.item,N,pic;for(var i in faceArray)N=faceArray[i],-1!=con.indexOf("[:"+N+"]")&&(pic='<img src="'+this.baseUrl+this.themeName+"/"+i+this.theme.fix+'" alt="'+N+'" title="'+N+'" />',con=con.replace(eval("/\\[:"+N.replace("(","\\(").replace(")","\\)")+"\\]/g"),pic));return con}},insertOnCursor.prototype={setCaret:function(){if($.browser.msie){var a=this;a.textBox.on("click select keyup",function(){a.textBox[0].caretPos=document.selection.createRange().duplicate()})}},insertAtCaret:function(a){var b=this.textBox[0];if(document.all&&b.createTextRange&&b.caretPos){var c=b.caretPos;c.text=""==c.text.charAt(c.text.length-1)?a+"":a}else if(b.setSelectionRange){var d=b.selectionStart,e=b.selectionEnd,f=b.value.substring(0,d),g=b.value.substring(e);b.value=f+a+g;var h=a.length;b.setSelectionRange(d+h,d+h)}else b.value+=a},unselectContents:function(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()},selectContents:function(){this.textBox.each(function(a){var b,c,d,e,f=this;(d=f.ownerDocument)&&(e=d.defaultView)&&"undefined"!=typeof e.getSelection&&"undefined"!=typeof d.createRange&&(b=window.getSelection())&&"undefined"!=typeof b.removeAllRanges?(c=d.createRange(),c.selectNode(f),0==a&&b.removeAllRanges(),b.addRange(c)):document.body&&"undefined"!=typeof document.body.createTextRange&&(c=document.body.createTextRange())&&(c.moveToElementText(f),c.select())})}},face});